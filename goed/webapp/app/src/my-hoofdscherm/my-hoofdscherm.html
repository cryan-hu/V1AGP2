
<dom-module id="my-hoofdscherm">
  <template>
    <style>
      :host {
        display: block;
      }

      span {
        @apply(--paper-font-body1);
      }
	  paper-button.optie{
		width: 220px;
	  }
	  table#opties{
	  margin-left: auto;
		margin-right: auto;
	  }
    iron-data-table{
      width: 17%;
      display: inline-block;
      height: 480px;
    }
    data-table-row[selected]{
      border: 1px solid gray;
      border-right: 1px solid gray;
      background-color: #F5F6CE;
    }
    data-table-row[header]{
      border: 0px solid gray;
      height: 50px;
    }
    data-table-row{
      border: 1px solid gray;
    }
    data-table-cell{
      width: 100%;
      height: 90px;
      padding: 7px;
    }
    .tijden{
      font-weight: bold;
    }
    span{
      display: block;
      text-align: center;
    }
    section.student [verborgen]{
      background-color: red;
    }

    </style>
  <span><iron-icon icon="arrow-back" on-click="terug"></iron-icon>Week 19<iron-icon icon="arrow-forward" on-click="verder"></iron-icon></span>
	<iron-ajax
    id="ajax_rooster_ophalen" 
    url="/student/rooster/ophalen" 
    method="POST" 
    on-response="_rooster_ophalen_response_handler" 
    last-response="{{data}}" >      
  </iron-ajax>
  <iron-ajax
    id="ajax_use_case" 
    url="/student/useCase/ophalen" 
    method="POST" 
    on-response="_use_case_response_handler" >      
  </iron-ajax>

  <iron-data-table datum="{{ma}}" items="[[data.maandag.lesgegevens]]" selection-enabled multi-selection>
    <data-table-column name="Maandag {{ma}}">
      <template>
      <table>
      <tr><td colspan="2" id="vak">[[item.les.vak]]</td></tr>
      <tr><td><span class="tijden">[[item.les.startTijd]]</span></td><td><span class="tijden">[[item.les.eindTijd]]</span></td></tr>
      <tr><td>[[item.les.lokaal]]</td><td>[[item.les.klas]]</td></tr>
      <tr><td colspan="2">[[item.les.emailDocent]]</td></tr>
      </table>
      </template>
    </data-table-column>
  </iron-data-table>
  <iron-data-table datum="{{di}}" items="[[data.dinsdag.lesgegevens]]" selection-enabled multi-selection>
    <data-table-column name="Dinsdag {{di}}">
      <template>
      <table>
      <tr><td colspan="2">[[item.les.vak]]</td></tr>
      <tr><td><span class="tijden">[[item.les.startTijd]]</span></td><td><span class="tijden">[[item.les.eindTijd]]</span></td></tr>
      <tr><td>[[item.les.lokaal]]</td><td>[[item.les.klas]]</td></tr>
      <tr><td colspan="2">[[item.les.emailDocent]]</td></tr>
      </table>
      </template>
    </data-table-column>
  </iron-data-table>
  <iron-data-table datum="{{wo}}" items="[[data.woensdag.lesgegevens]]" selection-enabled multi-selection>
    <data-table-column name="Woensdag {{wo}}">
      <template>
      <table>
      <tr><td colspan="2">[[item.les.vak]]</td></tr>
      <tr><td><span class="tijden">[[item.les.startTijd]]</span></td><td><span class="tijden">[[item.les.eindTijd]]</span></td></tr>
      <tr><td>[[item.les.lokaal]]</td><td>[[item.les.klas]]</td></tr>
      <tr><td colspan="2">[[item.les.emailDocent]]</td></tr>
      </table>
      </template>
    </data-table-column>
  </iron-data-table>
  <iron-data-table datum="{{do}}" items="[[data.donderdag.lesgegevens]]" selection-enabled multi-selection>
    <data-table-column name="Donderdag {{do}}">
      <template>
      <table>
      <tr><td colspan="2">[[item.les.vak]]</td></tr>
      <tr><td><span class="tijden">[[item.les.startTijd]]</span></td><td><span class="tijden">[[item.les.eindTijd]]</span></td></tr>
      <tr><td>[[item.les.lokaal]]</td><td>[[item.les.klas]]</td></tr>
      <tr><td colspan="2">[[item.les.emailDocent]]</td></tr>
      </table>
      </template>
    </data-table-column>
  </iron-data-table>
    <iron-data-table datum="{{vr}}" items="[[data.vrijdag.lesgegevens]]" selection-enabled multi-selection>
    <data-table-column name="Vrijdag {{vr}}">
      <template>
      <table>
      <tr><td colspan="2">[[item.les.vak]]</td></tr>
      <tr><td><span class="tijden">[[item.les.startTijd]]</span></td><td><span class="tijden">[[item.les.eindTijd]]</span></td></tr>
      <tr><td>[[item.les.lokaal]]</td><td>[[item.les.klas]]</td></tr>
      <tr><td colspan="2">[[item.les.emailDocent]]</td></tr>
      </table>
      </template>
    </data-table-column>
  </iron-data-table>
  
 
	<table id="opties">
	<tr>
	<td><paper-button on-click="_use_case_request_handler" args="ziekMelden" id="ziekMelden" class="optie" raised>Ziek melden</paper-button></td>
	<td><paper-button on-click="_use_case_request_handler" args="afwezigMelden" id="afwezigMelden" class="optie" raised>Afwezig melden</paper-button></td></tr>
	<tr><td><paper-button on-click="_use_case_request_handler" args="beterMelden" id="beterMelden" class="optie" raised>Beter melden</paper-button></td>
	<td><paper-button on-click="_use_case_request_handler" args="afwezigheidVerwijderen" id="afwezigheidVerwijderen" class="optie" raised>Afwezigheid verwijderen</paper-button></td></tr>
	</table>
  </template>

  <script>
    (function() {
      'use strict';
      /* _xxxx private              : geen external data binding      - geen notify
         _c_xx private constant     : geen external binding, constant - geen notify
         c_xx  public constant      : one way external databinding [[c_xx]] - geen notify nodig
         xxxx  public               : two way external databinding {{xxxx}} - notify nodig
      */
      Polymer({
        is: 'my-hoofdscherm',

        properties: {
		
          rol: {
            type: String,
            notify: true,
          },
          ma: {
            type: String,
            notify: true,
          },
          di: {
            type: String,
            notify: true,
          },
          wo: {
            type: String,
            notify: true,
          },
          do: {
            type: String,
            notify: true,
          },
          vr: {
            type: String,
            notify: true,
          },
          c_username:{
            type: String,
            notify: true,
          },
          selectedZondag:{
            type: Date,
            notify: true,
          },
          zondagDate:{
            type: Date,
            notify: true,
          },
          selectedItems:Array,
        },	

		    handleResponse: function(e) {
          console.log(e.detail.response);
          this.ma = "Maandag " + e.detail.response.maandag.datum;
          this.di = "Dinsdag " + e.detail.response.dinsdag.datum;
          this.wo = "Woensdag " + e.detail.response.woensdag.datum;
          this.do = "Donderdag " + e.detail.response.donderdag.datum;
          this.vr = "Vrijdag " + e.detail.response.vrijdag.datum;                                        

        },
      
        _go_home: function() {
          var lApp = document.querySelector('my-app');  //het polymer element <my-app>
          var lAppRouter = lApp.$.approuter;            // het html-element <app-route> met id=approuter
          lAppRouter.data={page: ""};                   // vul het data attribute met de homepage url
                                                        // door de two way binding in <app-route> en <app-location>
                                                        // zal ook de url echt wijzigen
         },
        _rooster_ophalen_request_handler: function() {
             console.log("_rooster_ophalen_request_handler user="+this.c_username);
             this.$.ajax_rooster_ophalen.contentType="application/json";
             this.$.ajax_rooster_ophalen.body={
               "username":this.c_username ,
               "maandagVanDeWeek":this.selectedZondag
             };
             this.$.ajax_rooster_ophalen.generateRequest();
           },

           _rooster_ophalen_response_handler: function(request) {
            let options = {  
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
            };
             console.log(request.detail.response);
              this.ma = request.detail.response.maandag.datum;
              this.di = request.detail.response.dinsdag.datum;
              this.wo = request.detail.response.woensdag.datum;
              this.do = request.detail.response.donderdag.datum;
              this.vr = request.detail.response.vrijdag.datum; 
           },
          _get_zondag: function(d){
                d = new Date(d);
                var day = d.getDay(),
                diff = d.getDate() - day + (day == 0 ? -6:0); // adjust when day is sunday
                return new Date(d.setDate(diff));
          },
          ready: function(){
            let options = {  
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
            };
            this.zondagDate = this._get_zondag(new Date());
            this.selectedZondag = this.zondagDate.toLocaleString('nl-nl', options); //returned als 09-04-2017;
            console.log(this.selectedZondag);
            this._rooster_ophalen_request_handler();
          },
          terug: function(){
            let options = {  
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
            };
            var d = this.zondagDate;
            d.setDate(d.getDate() - 7);
            this.selectedZondag = d.toLocaleString('nl-nl', options); //returned als 09-04-2017
            console.log(this.selectedZondag);
            this._rooster_ophalen_request_handler();
          },
          verder: function(){
            let options = {  
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
            };
            var d = this.zondagDate;
            d.setDate(d.getDate() + 7);
            this.selectedZondag = d.toLocaleString('nl-nl', options); //returned als 09-04-2017
            console.log(this.selectedZondag);
            this._rooster_ophalen_request_handler();
          },
          _get_selectie: function(){
            this.selectedItems = this.shadowRoot.querySelectorAll('data-table-row[selected]');
            var afwezigheden = [];
            for(var i=this.selectedItems.length - 1; i >= 0; i--){
              var tDatum = this.selectedItems[i].parentElement.datum;
              var lines =this.selectedItems[i].innerText.split('\n');
              var tVak = lines[0];
              var tStart = lines[1];
              var tEind = lines[2];
              var tKlas = lines[3];
              var tDocent = lines[4];
              var tLes = [tDatum,tVak,tStart,tEind,tKlas,tDocent];
              afwezigheden.push(tLes);
            }
              return afwezigheden;

          },

          _use_case_request_handler: function(e) {
            var useCase = e.target.getAttribute('args');
            if(this._get_selectie().length>0){
             console.log("_use_case_request_handler useCase= " + useCase);
             this.$.ajax_use_case.contentType="application/json";
             this.$.ajax_use_case.body={
               "afwezigheden":this._get_selectie(),
               "useCase":useCase
             };
             this.$.ajax_use_case.generateRequest();
           } else{
            console.log("geen selectie");
           }
           },
          _use_case_response_handler: function(request) {
            console.log("_use_case_response_handler useCase= " + request.detail.response.terugString);
           },

      });
    })();
  </script>
</dom-module>
